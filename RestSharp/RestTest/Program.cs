using System;
using System.Collections.Generic;
using System.Linq;
using System.Runtime.InteropServices;
using System.Text;
using System.Xml;
using RestSharp;

namespace RestTest
{
    class Program
    {
        private static string orderno = "P20121127";

        static void Main(string[] args)
        {
            for (int i = 0; i < 100; i++)
            {
                var c = i.ToString();
                System.Threading.Tasks.Task.Factory.StartNew(() =>
                    {

                    }).ContinueWith((task) =>
                        {
                            System.Threading.Tasks.Task.Factory.StartNew(() =>
                                {
                                    try
                                    {
                                        var content = CallAPI(c.ToString());
                                        Console.WriteLine(content);
                                    }
                                    catch (Exception ex)
                                    {

                                        Console.Write(ex.GetBaseException());
                                    }
                                });
                           

                        });
            }

            Console.WriteLine("完成");
            Console.ReadKey(false);
        }

        private static string CallAPI(string value)
        {
            int v = int.Parse(value);
            var client = Domas.DAP.ADF.SVCommon.ProxyBase.CreateRestClient();
            var request = new RestRequest("api/APITest/Post?orderno={orderno}&archivefileid={archivefileid}&printnum={printnum}", Method.POST);
            //request.AddHeader("Connection", "keep-alive");
            //request.AddHeader("Content-Type", "application/x-www-form-urlencoded");
            request.RequestFormat = RestSharp.DataFormat.Json;
            request.AddBody(new
            {
                barcodevaluelist = new List<string>
                {
                    "B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001"
                    ,"B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001"
                    ,"B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001"
                    ,"B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001"
                    ,"B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001"
                    ,"B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001"
                    ,"B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001"
                    ,"B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001"
                    ,"B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001"
                    ,"B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001"
                    ,"B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001"
                    ,"B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001"
                    ,"B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001"
                    ,"B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001"
                    ,"B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001"
                    ,"B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001"
                    ,"B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001"
                    ,"B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001"
                    ,"B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001"
                    ,"B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001"
                    ,"B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001"
                    ,"B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001"
                    ,"B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001"
                    ,"B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001"
                    ,"B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001"
                    ,"B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001"
                    ,"B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001"
                    ,"B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001"
                    ,"B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001"
                    ,"B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001"
                    ,"B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001"
                    ,"B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001"
                    ,"B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001"
                    ,"B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001"
                    ,"B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001"
                    ,"B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001"
                    ,"B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001","B2012112700001"
                }
            });
            request.AddUrlSegment("orderno", orderno + v.ToString("0000"));
            request.AddUrlSegment("archivefileid", value);
            request.AddUrlSegment("printnum", value);

            var response = client.Execute(request);
            
            //Console.WriteLine(response.ErrorException.GetBaseException().ToString());
            var content = response.Content;
            return content;
        }
    }
}
